<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="R pure : Workflow for flood frequency analysis under uncertainty (still work in progress!)">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>R pure</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/cvitolo/r_pure">View on GitHub</a>

          <h1 id="project_title">R pure</h1>
          <h2 id="project_tagline">Workflow for flood frequency analysis under uncertainty (still work in progress!)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/cvitolo/r_pure/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/cvitolo/r_pure/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="pure-r-package" class="anchor" href="#pure-r-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>PURE (R package)</h1>

<p>Workflow for flood frequency analysis under uncertainty (work in progress!).</p>

<p>Project: PURE (Probability, Uncertainty and Risk in the Environment) - RACER consortium (Flood strand)</p>

<p>Check out: NERC-PURE programme at <a href="http://www.nerc.ac.uk/research/programmes/pure/">http://www.nerc.ac.uk/research/programmes/pure/</a>.</p>

<p>Requirements:
sudo apt-get install libudunits2-dev
install.packages("hydroTSM")</p>

<h4>
<a id="basics" class="anchor" href="#basics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basics</h4>

<p>Install and load packages</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install dependent packages from CRAN:</span>
<span class="nv">x</span> <span class="o">&lt;-</span> c(<span class="s2">"zoo"</span>, <span class="s2">"chron"</span>, <span class="s2">"xts"</span>, <span class="s2">"manipulate"</span>, <span class="s2">"rgdal"</span>, <span class="s2">"tgp"</span>,
       <span class="s2">"sp"</span>, <span class="s2">"gstat"</span>, <span class="s2">"grid"</span>, <span class="s2">"hydroTSM"</span>, <span class="s2">"Hmisc"</span>, <span class="s2">"raster"</span>, <span class="s2">"reshape2"</span>, 
       <span class="s2">"ggplot2"</span>, <span class="s2">"qualV"</span>, <span class="s2">"lhs"</span>, <span class="s2">"MASS"</span>)
install.packages(<span class="nv">x</span>)
lapply(<span class="nv">x</span>, <span class="nv">require</span>, <span class="nv">character.only</span><span class="o">=</span><span class="kc">T</span>); rm(<span class="nv">x</span>)

<span class="c1"># Install dpendent package from R-Forge:</span>
install.packages(<span class="s2">"fuse"</span>, <span class="nv">repos</span><span class="o">=</span><span class="s2">"http://R-Forge.R-project.org"</span>)

<span class="c1"># Install dependent gists and packages from github:</span>
library(<span class="nv">devtools</span>)
install_github(<span class="s2">"cvitolo/r_rnrfa"</span>, <span class="nv">subdir</span> <span class="o">=</span> <span class="s2">"rnrfa"</span>)

<span class="c1"># Install pure package</span>
install_github(<span class="s2">"cvitolo/r_pure"</span>, <span class="nv">subdir</span> <span class="o">=</span> <span class="s2">"pure"</span>)</pre></div>

<p>Make zoo objects for your time series: </p>

<ul>
<li>Q is the streamflow time series. </li>
<li>E is the list of potential evapotranspiration time series. If E is unknown, wheather variables can be used to calculate the potential evapotranspiration (see section PET).</li>
<li>P is the list of rainfall time series. If there are 3 raingauges in the catchment (e.g. P1, P2 and P3), the object P is: 

<ul>
<li>P &lt;- list(P1,P2,P3)</li>
</ul>
</li>
</ul>

<p>An example is given below:</p>

<div class="highlight highlight-R"><pre>library(<span class="nv">pure</span>)
<span class="c1"># Load sample time series (this contains 3 objects: P, E and Q)</span>
data(<span class="nv">P1</span>)
data(<span class="nv">P2</span>)
data(<span class="nv">P3</span>)
data(<span class="nv">Q</span>)
data(<span class="nv">weather</span>)</pre></div>

<h3>
<a id="pre-processing" class="anchor" href="#pre-processing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pre-processing</h3>

<p>Below are a series of utility functions for time series pre-processing, divided in 4 categories: </p>

<ul>
<li>Report</li>
<li>Correct</li>
<li>Aggregate</li>
<li>Model specific preparation</li>
</ul>

<h5>
<a id="report" class="anchor" href="#report" aria-hidden="true"><span class="octicon octicon-link"></span></a>Report</h5>

<p>Report problems with time series using the function <code>ScanTS()</code>.
As an example you can use the example dataset provided with this package.</p>

<div class="highlight highlight-R"><pre><span class="c1"># Report</span>
ScanTS( <span class="nv">P1</span>, <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">TRUE</span>  )
ScanTS( <span class="nv">P2</span>, <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">P3</span>, <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">Q</span>,  <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">weather</span><span class="k">$</span><span class="nv">TD</span>,  <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span>, <span class="nv">returnNegInfo</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">weather</span><span class="k">$</span><span class="nv">TW</span>,  <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span>, <span class="nv">returnNegInfo</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">weather</span><span class="k">$</span><span class="nv">NR</span>,  <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span>, <span class="nv">returnNegInfo</span> <span class="o">=</span> <span class="kc">FALSE</span> )
ScanTS( <span class="nv">weather</span><span class="k">$</span><span class="nv">WS</span>,  <span class="nv">verbose</span> <span class="o">=</span> <span class="kc">FALSE</span> )</pre></div>

<h5>
<a id="correct-aggregate-and-prepare-for-modelling-with-fuse" class="anchor" href="#correct-aggregate-and-prepare-for-modelling-with-fuse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Correct, aggregate and prepare for modelling with FUSE</h5>

<p>Often time series are recorded at non-regular time steps. You can shift your records to align them with a regular grid using the function <code>Irr2Reg()</code>.</p>

<div class="highlight highlight-R"><pre><span class="c1"># From irregular to regular frequency time step:</span>
<span class="nv">P1Reg</span> <span class="o">&lt;-</span> Irr2Reg( <span class="nv">P1</span> )
<span class="nv">P2Reg</span> <span class="o">&lt;-</span> Irr2Reg( <span class="nv">P2</span> )
<span class="nv">P3Reg</span> <span class="o">&lt;-</span> Irr2Reg( <span class="nv">P3</span> )
<span class="nv">QReg</span>  <span class="o">&lt;-</span> Irr2Reg( <span class="nv">Q</span> )
<span class="nv">TW</span>    <span class="o">&lt;-</span> Irr2Reg( <span class="nv">weather</span><span class="k">$</span><span class="nv">TW</span> )
<span class="nv">TD</span>    <span class="o">&lt;-</span> Irr2Reg( <span class="nv">weather</span><span class="k">$</span><span class="nv">TD</span> )
<span class="nv">NR</span>    <span class="o">&lt;-</span> Irr2Reg( <span class="nv">weather</span><span class="k">$</span><span class="nv">NR</span> )
<span class="nv">WS</span>    <span class="o">&lt;-</span> Irr2Reg( <span class="nv">weather</span><span class="k">$</span><span class="nv">WS</span> )

<span class="c1"># test the effect of Irr2Reg()</span>
plot(<span class="nv">P1</span>[<span class="m">40</span><span class="k">:</span><span class="m">45</span>])
lines(<span class="nv">P1Reg</span>[<span class="m">40</span><span class="k">:</span><span class="m">45</span>],<span class="nv">col</span><span class="o">=</span><span class="s2">"red"</span>)</pre></div>

<p>Change any unrealistic values to NA (e.g. negative P and Q) using the function <code>CorrectNeg()</code>. </p>

<div class="highlight highlight-R"><pre><span class="nv">P1NoNeg</span> <span class="o">&lt;-</span> CorrectNeg( <span class="nv">P1Reg</span> )</pre></div>

<h5>
<a id="common-temporal-resolution" class="anchor" href="#common-temporal-resolution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common temporal resolution</h5>

<p>Find coarser temporal resolution (in seconds!) amongst a list of time series and aggregate all of them to the same temporal resolution</p>

<div class="highlight highlight-R"><pre><span class="nv">myList</span> <span class="o">&lt;-</span> <span class="kt">list</span>(<span class="s2">"P1"</span> <span class="o">=</span> <span class="nv">P1NoNeg</span>, <span class="s2">"P2"</span> <span class="o">=</span> <span class="nv">P2Reg</span>, <span class="s2">"P3"</span> <span class="o">=</span> <span class="nv">P3Reg</span>, 
               <span class="s2">"Q"</span> <span class="o">=</span> <span class="nv">QReg</span>, <span class="s2">"TW"</span> <span class="o">=</span> <span class="nv">TW</span>, <span class="s2">"TD"</span> <span class="o">=</span> <span class="nv">TD</span>, <span class="s2">"NR"</span> <span class="o">=</span> <span class="nv">NR</span>, <span class="s2">"WS"</span> <span class="o">=</span> <span class="nv">WS</span>)
<span class="nv">x</span> <span class="o">&lt;-</span> CommonTemporalResolution(<span class="nv">myList</span>)

<span class="c1"># use "mean" for rates, "sum" for volumes</span>
<span class="nv">P1</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">P1</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">P1</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">P2</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">P2</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">P2</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">P3</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">P3</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">P3</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">TW</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">TW</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">TW</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">TD</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">TD</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">TD</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">NR</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">NR</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">NR</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">WS</span> <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">WS</span>, endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">WS</span>, <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)
<span class="nv">Q</span>  <span class="o">&lt;-</span> period.apply(<span class="nv">myList</span><span class="k">$</span><span class="nv">Q</span>,  endpoints(<span class="nv">myList</span><span class="k">$</span><span class="nv">Q</span>,  <span class="s2">"seconds"</span>, <span class="nv">x</span>), <span class="nv">mean</span>)</pre></div>

<p>Derive new variables, e.g. potential evapotranspiration from weather variables</p>

<div class="highlight highlight-R"><pre><span class="nv">E</span> <span class="o">&lt;-</span> pet(<span class="nv">stationElevation</span><span class="o">=</span><span class="m">0</span>,<span class="nv">TD</span>,<span class="nv">TW</span>,<span class="nv">NR</span>,<span class="nv">WS</span>)</pre></div>

<p>Align time stamps</p>

<div class="highlight highlight-R"><pre><span class="c1"># format time index consistently</span>
<span class="nv">P1a</span> <span class="o">&lt;-</span> align.time(<span class="nv">P1</span>, <span class="nv">x</span>)
<span class="nv">P2a</span> <span class="o">&lt;-</span> align.time(<span class="nv">P2</span>, <span class="nv">x</span>)
<span class="nv">P3a</span> <span class="o">&lt;-</span> align.time(<span class="nv">P3</span>, <span class="nv">x</span>)
<span class="nv">Ea</span> <span class="o">&lt;-</span> align.time(<span class="nv">E</span>, <span class="nv">x</span>)
<span class="nv">Qa</span> <span class="o">&lt;-</span> align.time(<span class="nv">Q</span>, <span class="nv">x</span>)
</pre></div>

<p>Select periods with simultaneous recordings</p>

<div class="highlight highlight-R"><pre><span class="c1"># Select periods with simultaneous recordings</span>
<span class="nv">newList</span> <span class="o">&lt;-</span> CommonRecordingTime(<span class="kt">list</span>(<span class="s2">"P1"</span> <span class="o">=</span> <span class="nv">P1a</span>, <span class="s2">"P2"</span> <span class="o">=</span> <span class="nv">P2a</span>, <span class="s2">"P3"</span> <span class="o">=</span> <span class="nv">P3a</span>, 
                                    <span class="s2">"E"</span> <span class="o">=</span> <span class="nv">Ea</span>, <span class="s2">"Q"</span> <span class="o">=</span> <span class="nv">Qa</span>) )</pre></div>

<p>Aggregate in space, e.g. areal averaging using spatial interpolation methods</p>

<div class="highlight highlight-R"><pre><span class="nv">tsList</span> <span class="o">&lt;-</span> <span class="kt">data.frame</span>(index(<span class="nv">newList</span>),<span class="s2">"P1"</span><span class="o">=</span><span class="nv">newList</span><span class="k">$</span><span class="nv">P1</span>,
                     <span class="s2">"P2"</span><span class="o">=</span><span class="nv">newList</span><span class="k">$</span><span class="nv">P2</span>,<span class="s2">"P2"</span><span class="o">=</span><span class="nv">newList</span><span class="k">$</span><span class="nv">P3</span>)

<span class="nv">P</span> <span class="o">&lt;-</span> ArealAveraging(<span class="nv">tsList</span>,<span class="nv">areas</span><span class="o">=</span>c(<span class="m">0.3</span>,<span class="m">0.6</span>,<span class="m">0.1</span>),
                    <span class="nv">interpolationMethod</span> <span class="o">=</span><span class="s2">"Thiessen"</span>)</pre></div>

<p>Check if there are gaps in the records and infill</p>

<div class="highlight highlight-R"><pre>any(is.na(<span class="nv">P</span>)) <span class="c1"># FALSE</span>

any(is.na(<span class="nv">newList</span><span class="k">$</span><span class="nv">E</span>)) <span class="c1"># This returns TRUE, infill the missing values</span>
<span class="nv">Enomissing</span> <span class="o">&lt;-</span> na.approx(<span class="nv">newList</span><span class="k">$</span><span class="nv">E</span>)

any(is.na(<span class="nv">newList</span><span class="k">$</span><span class="nv">Q</span>)) <span class="c1"># This returns TRUE, infill the missing values</span>
<span class="nv">Qnomissing</span> <span class="o">&lt;-</span> na.approx(<span class="nv">newList</span><span class="k">$</span><span class="nv">Q</span>)</pre></div>

<p>If necessary, convert units to mm/day:</p>

<div class="highlight highlight-R"><pre><span class="c1"># P is already in mm/day</span>
<span class="nv">E</span> <span class="o">&lt;-</span> <span class="nv">Enomissing</span><span class="o">*</span><span class="m">24</span> <span class="c1"># from mm/h to mm/day</span>

<span class="nv">Area</span> <span class="o">&lt;-</span> <span class="m">10.55</span> <span class="c1"># Km2</span>
<span class="nv">Q</span> <span class="o">&lt;-</span> <span class="nv">Qnomissing</span><span class="o">*</span><span class="m">0.086.4</span><span class="o">/</span><span class="nv">Area</span> <span class="c1"># from l/s to mm/day</span></pre></div>

<p>Merge P, E and Q in 1 time series object</p>

<div class="highlight highlight-R"><pre><span class="nv">DATA</span> <span class="o">&lt;-</span> merge(<span class="nv">P</span>,<span class="nv">E</span>,<span class="nv">Q</span>)</pre></div>

<h3>
<a id="rainfall-runoff-modelling-using-fuse" class="anchor" href="#rainfall-runoff-modelling-using-fuse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rainfall-Runoff modelling using FUSE</h3>

<p>As an example, we could combine 50 parameter sets and 4 model structures to generate 200 model simulations.</p>

<p>Sample 50 parameter sets for FUSE, using LHS method</p>

<div class="highlight highlight-R"><pre>library(<span class="nv">fuse</span>)
data(<span class="nv">DATA</span>)

set.seed(<span class="m">123</span>)
<span class="nv">NumberOfRuns</span> <span class="o">&lt;-</span> <span class="m">10</span>    
<span class="nv">parameters</span> <span class="o">&lt;-</span> GeneratePsetsFUSE(<span class="nv">NumberOfRuns</span>)</pre></div>

<p>Choose a list of models to take into account</p>

<div class="highlight highlight-R"><pre><span class="nv">parentModels</span> <span class="o">&lt;-</span> c(<span class="m">60</span>,<span class="m">230</span>,<span class="m">342</span>,<span class="m">426</span>) <span class="c1"># those are the parent models</span></pre></div>

<p>Define the list of Model Performance Indices (MPIs)</p>

<div class="highlight highlight-R"><pre>library(<span class="nv">tiger</span>)
library(<span class="nv">qualV</span>)

<span class="nv">LAGTIME</span> <span class="o">=</span> <span class="k">function</span>(<span class="nv">x</span>) lagtime(<span class="nv">x</span><span class="k">$</span><span class="nv">Qo</span>,<span class="nv">x</span><span class="k">$</span><span class="nv">Qs</span>)    
<span class="nv">MAE</span>     <span class="o">=</span> <span class="k">function</span>(<span class="nv">x</span>) mean(<span class="nv">x</span><span class="k">$</span><span class="nv">Qs</span> <span class="o">-</span> <span class="nv">x</span><span class="k">$</span><span class="nv">Qo</span>, <span class="nv">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span>)            
<span class="nv">NSHF</span>    <span class="o">=</span> <span class="k">function</span>(<span class="nv">x</span>) <span class="m">1</span> <span class="o">-</span> EF(<span class="nv">x</span><span class="k">$</span><span class="nv">Qo</span>,<span class="nv">x</span><span class="k">$</span><span class="nv">Qs</span>)           
<span class="nv">NSLF</span>    <span class="o">=</span> <span class="k">function</span>(<span class="nv">x</span>) <span class="m">1</span> <span class="o">-</span> EF( log(<span class="nv">x</span><span class="k">$</span><span class="nv">Qo</span>) , log(<span class="nv">x</span><span class="k">$</span><span class="nv">Qs</span>) )           
<span class="nv">RR</span>      <span class="o">=</span> <span class="k">function</span>(<span class="nv">x</span>) sum(<span class="nv">x</span><span class="k">$</span><span class="nv">Qs</span>) <span class="o">/</span>sum(<span class="nv">x</span><span class="k">$</span><span class="nv">Po</span>)

<span class="nv">MPIs</span> <span class="o">&lt;-</span> <span class="kt">list</span>(<span class="s2">"LAGTIME"</span><span class="o">=</span><span class="nv">LAGTIME</span>,<span class="s2">"MAE"</span><span class="o">=</span><span class="nv">MAE</span>,<span class="s2">"NSHF"</span><span class="o">=</span><span class="nv">NSHF</span>,<span class="s2">"NSLF"</span><span class="o">=</span><span class="nv">NSLF</span>,<span class="s2">"RR"</span><span class="o">=</span><span class="nv">RR</span>)</pre></div>

<p>Run simulations</p>

<div class="highlight highlight-R"><pre><span class="nv">outputFolder</span> <span class="o">&lt;-</span> <span class="s2">"~"</span>
<span class="nv">deltim</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">/</span><span class="m">24</span> <span class="c1"># or dt/60/60/24</span>
<span class="nv">warmup</span> <span class="o">&lt;-</span> round(dim(<span class="nv">DATA</span>)[<span class="m">1</span>]<span class="o">/</span><span class="m">10</span>,<span class="m">0</span>)

<span class="c1"># It is recommended to run simulations on HPC facilities. </span>
<span class="c1"># However small batches can be run locally using the function MCsimulations()</span>
MCsimulations(<span class="nv">DATA</span>,<span class="nv">deltim</span>,<span class="nv">warmup</span>,<span class="nv">parameters</span>,<span class="nv">parentModels</span>,<span class="nv">outputFolder</span>,<span class="nv">MPIs</span>)</pre></div>

<h3>
<a id="find-the-best-configurations-amongst-those-simulated" class="anchor" href="#find-the-best-configurations-amongst-those-simulated" aria-hidden="true"><span class="octicon octicon-link"></span></a>Find the best configuration(s) amongst those simulated</h3>

<p>For this task it is necessary to install another experimental package called AMCA:</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install pure package</span>
install_github(<span class="s2">"cvitolo/r_amca"</span>, <span class="nv">subdir</span> <span class="o">=</span> <span class="s2">"amca"</span>)
library(<span class="nv">amca</span>)</pre></div>

<p>Run the algorithm:</p>

<div class="highlight highlight-R"><pre><span class="nv">results</span> <span class="o">&lt;-</span> amca(<span class="nv">DATA</span>,<span class="nv">ModelList</span>,<span class="nv">warmup</span>,<span class="nv">parameters</span>,<span class="nv">outputFolder</span>)</pre></div>

<p>The best configuration is stored in</p>

<div class="highlight highlight-R"><pre><span class="nv">results</span><span class="k">$</span><span class="nv">RETable</span></pre></div>

<h3>
<a id="frequency-analysis" class="anchor" href="#frequency-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frequency Analysis</h3>

<p>For this task it is necessary to install another packages:</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install and load packages </span>
install.packages(<span class="s2">"hydromad"</span>, <span class="nv">repos</span><span class="o">=</span><span class="s2">"http://hydromad.catchment.org"</span>)
install.packages(<span class="s2">"EcoHydRology"</span>)
library(<span class="nv">EcoHydRology</span>)</pre></div>

<p>Identify events Precipitation-discharge events:</p>

<div class="highlight highlight-R"><pre><span class="nv">df</span> <span class="o">&lt;-</span> EventIdentification(<span class="nv">DATA</span>)</pre></div>

<h3>
<a id="curve-number" class="anchor" href="#curve-number" aria-hidden="true"><span class="octicon octicon-link"></span></a>Curve Number</h3>

<p>Determine the CN for each event where P &amp; Q are in inches and area is in acre</p>

<div class="highlight highlight-R"><pre><span class="nv">Q</span> <span class="o">&lt;-</span> <span class="nv">df</span><span class="k">$</span><span class="nv">Q</span><span class="o">/</span><span class="m">25.4</span>       <span class="c1"># in inches</span>
<span class="nv">P</span> <span class="o">&lt;-</span> <span class="nv">df</span><span class="k">$</span><span class="nv">P</span><span class="o">/</span><span class="m">25.5</span>       <span class="c1"># in inches</span>
<span class="nv">area</span> <span class="o">&lt;-</span> <span class="nv">Area</span><span class="o">*</span><span class="m">247.105</span> <span class="c1"># in acre</span>

<span class="nv">CN</span> <span class="o">&lt;-</span> calculateCN(<span class="nv">P</span>,<span class="nv">Q</span>); <span class="nv">df</span><span class="k">$</span><span class="nv">CN</span> <span class="o">&lt;-</span> <span class="nv">CN</span>
<span class="nv">myCN</span> <span class="o">&lt;-</span> median( sort(<span class="nv">CN</span>, <span class="nv">decreasing</span> <span class="o">=</span> <span class="kc">TRUE</span>)[<span class="m">1</span><span class="k">:</span><span class="m">5</span>] )
</pre></div>

<h1>
<a id="leave-your-feedback" class="anchor" href="#leave-your-feedback" aria-hidden="true"><span class="octicon octicon-link"></span></a>Leave your feedback</h1>

<p>I would greatly appreciate if you could leave your feedbacks via email (<a href="mailto:cvitolodev@gmail.com">cvitolodev@gmail.com</a>).</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">R pure maintained by <a href="https://github.com/cvitolo">cvitolo</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-44379190-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
