<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="R pure : Workflow for flood frequency analysis under uncertainty (still work in progress!)">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>R pure</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/cvitolo/r_pure">View on GitHub</a>

          <h1 id="project_title">R pure</h1>
          <h2 id="project_tagline">Workflow for flood frequency analysis under uncertainty (still work in progress!)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/cvitolo/r_pure/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/cvitolo/r_pure/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="pure-r-package" class="anchor" href="#pure-r-package"><span class="octicon octicon-link"></span></a>PURE (R package)</h1>

<p>Workflow for flood frequency analysis under uncertainty (work in progress!).</p>

<p>Project: PURE (Probability, Uncertainty and Risk in the Environment) - RACER consortium (Flood strand)</p>

<p>Check out: NERC-PURE programme at <a href="http://www.nerc.ac.uk/research/programmes/pure/">http://www.nerc.ac.uk/research/programmes/pure/</a>.</p>

<p>Requirements:
sudo apt-get install libudunits2-dev
install.packages("hydroTSM")</p>

<h4>
<a name="basics" class="anchor" href="#basics"><span class="octicon octicon-link"></span></a>Basics</h4>

<p>Install and load packages</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install dependent packages from CRAN:</span>
x <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">"zoo"</span><span class="p">,</span> <span class="s">"chron"</span><span class="p">,</span> <span class="s">"xts"</span><span class="p">,</span> <span class="s">"manipulate"</span><span class="p">,</span> <span class="s">"rgdal"</span><span class="p">,</span> <span class="s">"tgp"</span><span class="p">,</span>
       <span class="s">"sp"</span><span class="p">,</span> <span class="s">"gstat"</span><span class="p">,</span> <span class="s">"grid"</span><span class="p">,</span> <span class="s">"hydroTSM"</span><span class="p">,</span> <span class="s">"Hmisc"</span><span class="p">,</span> <span class="s">"raster"</span><span class="p">,</span> <span class="s">"reshape2"</span><span class="p">,</span> 
       <span class="s">"ggplot2"</span><span class="p">,</span> <span class="s">"qualV"</span><span class="p">,</span> <span class="s">"lhs"</span><span class="p">,</span> <span class="s">"MASS"</span><span class="p">)</span>
install.packages<span class="p">(</span>x<span class="p">)</span>
<span class="kp">lapply</span><span class="p">(</span>x<span class="p">,</span> <span class="kn">require</span><span class="p">,</span> character.only<span class="o">=</span><span class="bp">T</span><span class="p">);</span> <span class="kp">rm</span><span class="p">(</span>x<span class="p">)</span>

<span class="c1"># Install dpendent package from R-Forge:</span>
install.packages<span class="p">(</span><span class="s">"fuse"</span><span class="p">,</span> repos<span class="o">=</span><span class="s">"http://R-Forge.R-project.org"</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>fuse<span class="p">)</span>

<span class="c1"># Install dependent gists and packages from github:</span>
<span class="kn">library</span><span class="p">(</span>devtools<span class="p">)</span>
install_github<span class="p">(</span><span class="s">"r_rnrfa"</span><span class="p">,</span> username <span class="o">=</span> <span class="s">"cvitolo"</span><span class="p">,</span> subdir <span class="o">=</span> <span class="s">"rnrfa"</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>rnrfa<span class="p">)</span>

<span class="c1"># Install pure package</span>
install_github<span class="p">(</span><span class="s">"r_pure"</span><span class="p">,</span> username <span class="o">=</span> <span class="s">"cvitolo"</span><span class="p">,</span> subdir <span class="o">=</span> <span class="s">"pure"</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>pure<span class="p">)</span>
</pre></div>

<p>Make zoo objects for your time series: </p>

<ul>
<li>Q is the streamflow time series. </li>
<li>E is the list of potential evapotranspiration time series. If E is unknown, wheather variables can be used to calculate the potential evapotranspiration (see section PET).</li>
<li>P is the list of rainfall time series. If there are 3 raingauges in the catchment (e.g. P1, P2 and P3), the object P is: 

<ul>
<li>P &lt;- list(P1,P2,P3)</li>
</ul>
</li>
</ul>

<p>An example is given below:</p>

<div class="highlight highlight-R"><pre><span class="c1"># Load sample time series (this contains 3 objects: P, E and Q)</span>
data<span class="p">(</span>P1<span class="p">)</span>
data<span class="p">(</span>P2<span class="p">)</span>
data<span class="p">(</span>P3<span class="p">)</span>
data<span class="p">(</span>Q<span class="p">)</span>
data<span class="p">(</span>weather<span class="p">)</span>
</pre></div>

<h3>
<a name="pre-processing" class="anchor" href="#pre-processing"><span class="octicon octicon-link"></span></a>Pre-processing</h3>

<p>Below are a series of utility functions for time series pre-processing, divided in 4 categories: </p>

<ul>
<li>Report</li>
<li>Correct</li>
<li>Aggregate</li>
<li>Model specific preparation</li>
</ul>

<h5>
<a name="report" class="anchor" href="#report"><span class="octicon octicon-link"></span></a>Report</h5>

<p>Report problems with time series using the function <code>ScanTS()</code>.
As an example you can use the example dataset provided with this package.</p>

<div class="highlight highlight-R"><pre><span class="c1"># Report</span>
ScanTS<span class="p">(</span> P1<span class="p">,</span> verbose <span class="o">=</span> <span class="kc">TRUE</span>  <span class="p">)</span>
ScanTS<span class="p">(</span> P2<span class="p">,</span> verbose <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> P3<span class="p">,</span> verbose <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> Q<span class="p">,</span>  verbose <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> weather<span class="o">$</span>TD<span class="p">,</span>  verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> returnNegInfo <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> weather<span class="o">$</span>TW<span class="p">,</span>  verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> returnNegInfo <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> weather<span class="o">$</span>NR<span class="p">,</span>  verbose <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> returnNegInfo <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
ScanTS<span class="p">(</span> weather<span class="o">$</span>WS<span class="p">,</span>  verbose <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
</pre></div>

<h5>
<a name="correct-aggregate-and-prepare-for-modelling-with-fuse" class="anchor" href="#correct-aggregate-and-prepare-for-modelling-with-fuse"><span class="octicon octicon-link"></span></a>Correct, aggregate and prepare for modelling with FUSE</h5>

<p>Often time series are recorded at non-regular time steps. You can shift your records to align them with a regular grid using the function <code>Irr2Reg()</code>.</p>

<div class="highlight highlight-R"><pre><span class="c1"># From irregular to regular frequency time step:</span>
P1Reg <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> P1 <span class="p">)</span>
P2Reg <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> P2 <span class="p">)</span>
P3Reg <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> P3 <span class="p">)</span>
QReg  <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> Q <span class="p">)</span>
TW    <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> weather<span class="o">$</span>TW <span class="p">)</span>
TD    <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> weather<span class="o">$</span>TD <span class="p">)</span>
NR    <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> weather<span class="o">$</span>NR <span class="p">)</span>
WS    <span class="o">&lt;-</span> Irr2Reg<span class="p">(</span> weather<span class="o">$</span>WS <span class="p">)</span>

<span class="c1"># test the effect of Irr2Reg()</span>
plot<span class="p">(</span>P1<span class="p">[</span><span class="m">40</span><span class="o">:</span><span class="m">45</span><span class="p">])</span>
lines<span class="p">(</span>P1Reg<span class="p">[</span><span class="m">40</span><span class="o">:</span><span class="m">45</span><span class="p">],</span>col<span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
</pre></div>

<p>Change any unrealistic values to NA (e.g. negative P and Q) using the function <code>CorrectNeg()</code>. </p>

<div class="highlight highlight-R"><pre>P1NoNeg <span class="o">&lt;-</span> CorrectNeg<span class="p">(</span> P1Reg <span class="p">)</span>
</pre></div>

<h5>
<a name="common-temporal-resolution" class="anchor" href="#common-temporal-resolution"><span class="octicon octicon-link"></span></a>Common temporal resolution</h5>

<p>Find coarser temporal resolution (in seconds!) amongst a list of time series and aggregate all of them to the same temporal resolution</p>

<div class="highlight highlight-R"><pre>myList <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span><span class="s">"P1"</span> <span class="o">=</span> P1NoNeg<span class="p">,</span> <span class="s">"P2"</span> <span class="o">=</span> P2Reg<span class="p">,</span> <span class="s">"P3"</span> <span class="o">=</span> P3Reg<span class="p">,</span> 
               <span class="s">"Q"</span> <span class="o">=</span> QReg<span class="p">,</span> <span class="s">"TW"</span> <span class="o">=</span> TW<span class="p">,</span> <span class="s">"TD"</span> <span class="o">=</span> TD<span class="p">,</span> <span class="s">"NR"</span> <span class="o">=</span> NR<span class="p">,</span> <span class="s">"WS"</span> <span class="o">=</span> WS<span class="p">)</span>
x <span class="o">&lt;-</span> CommonTemporalResolution<span class="p">(</span>myList<span class="p">)</span>

<span class="c1"># use "mean" for rates, "sum" for volumes</span>
P1 <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>P1<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>P1<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
P2 <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>P2<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>P2<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
P3 <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>P3<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>P3<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
TW <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>TW<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>TW<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
TD <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>TD<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>TD<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
NR <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>NR<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>NR<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
WS <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>WS<span class="p">,</span> endpoints<span class="p">(</span>myList<span class="o">$</span>WS<span class="p">,</span> <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
Q  <span class="o">&lt;-</span> period.apply<span class="p">(</span>myList<span class="o">$</span>Q<span class="p">,</span>  endpoints<span class="p">(</span>myList<span class="o">$</span>Q<span class="p">,</span>  <span class="s">"seconds"</span><span class="p">,</span> x<span class="p">),</span> <span class="kp">mean</span><span class="p">)</span>
</pre></div>

<p>Derive new variables, e.g. potential evapotranspiration from weather variables</p>

<div class="highlight highlight-R"><pre>E <span class="o">&lt;-</span> pet<span class="p">(</span>stationElevation<span class="o">=</span><span class="m">0</span><span class="p">,</span>TD<span class="p">,</span>TW<span class="p">,</span>NR<span class="p">,</span>WS<span class="p">)</span>
</pre></div>

<p>Align time stamps</p>

<div class="highlight highlight-R"><pre><span class="c1"># format time index consistently</span>
P1a <span class="o">&lt;-</span> align.time<span class="p">(</span>P1<span class="p">,</span> x<span class="p">)</span>
P2a <span class="o">&lt;-</span> align.time<span class="p">(</span>P2<span class="p">,</span> x<span class="p">)</span>
P3a <span class="o">&lt;-</span> align.time<span class="p">(</span>P3<span class="p">,</span> x<span class="p">)</span>
Ea <span class="o">&lt;-</span> align.time<span class="p">(</span>E<span class="p">,</span> x<span class="p">)</span>
Qa <span class="o">&lt;-</span> align.time<span class="p">(</span>Q<span class="p">,</span> x<span class="p">)</span>

</pre></div>

<p>Select periods with simultaneous recordings</p>

<div class="highlight highlight-R"><pre><span class="c1"># Select periods with simultaneous recordings</span>
newList <span class="o">&lt;-</span> CommonRecordingTime<span class="p">(</span><span class="kt">list</span><span class="p">(</span><span class="s">"P1"</span> <span class="o">=</span> P1a<span class="p">,</span> <span class="s">"P2"</span> <span class="o">=</span> P2a<span class="p">,</span> <span class="s">"P3"</span> <span class="o">=</span> P3a<span class="p">,</span> 
                                    <span class="s">"E"</span> <span class="o">=</span> Ea<span class="p">,</span> <span class="s">"Q"</span> <span class="o">=</span> Qa<span class="p">)</span> <span class="p">)</span>
</pre></div>

<p>Aggregate in space, e.g. areal averaging using spatial interpolation methods</p>

<div class="highlight highlight-R"><pre>tsList <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>index<span class="p">(</span>newList<span class="p">),</span><span class="s">"P1"</span><span class="o">=</span>newList<span class="o">$</span>P1<span class="p">,</span>
                     <span class="s">"P2"</span><span class="o">=</span>newList<span class="o">$</span>P2<span class="p">,</span><span class="s">"P2"</span><span class="o">=</span>newList<span class="o">$</span>P3<span class="p">)</span>

P <span class="o">&lt;-</span> ArealAveraging<span class="p">(</span>tsList<span class="p">,</span>areas<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="m">0.6</span><span class="p">,</span><span class="m">0.1</span><span class="p">),</span>
                    interpolationMethod <span class="o">=</span><span class="s">"Thiessen"</span><span class="p">)</span>
</pre></div>

<p>Check if there are gaps in the records and infill</p>

<div class="highlight highlight-R"><pre><span class="kp">any</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>P<span class="p">))</span> <span class="c1"># FALSE</span>

<span class="kp">any</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>newList<span class="o">$</span>E<span class="p">))</span> <span class="c1"># This returns TRUE, infill the missing values</span>
Enomissing <span class="o">&lt;-</span> na.approx<span class="p">(</span>newList<span class="o">$</span>E<span class="p">)</span>

<span class="kp">any</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>newList<span class="o">$</span>Q<span class="p">))</span> <span class="c1"># This returns TRUE, infill the missing values</span>
Qnomissing <span class="o">&lt;-</span> na.approx<span class="p">(</span>newList<span class="o">$</span>Q<span class="p">)</span>
</pre></div>

<p>If necessary, convert units to mm/day:</p>

<div class="highlight highlight-R"><pre><span class="c1"># P is already in mm/day</span>
E <span class="o">&lt;-</span> Enomissing<span class="o">*</span><span class="m">24</span> <span class="c1"># from mm/h to mm/day</span>

Area <span class="o">&lt;-</span> <span class="m">10.55</span> <span class="c1"># Km2</span>
Q <span class="o">&lt;-</span> Qnomissing<span class="o">*</span><span class="m">0.086.4</span><span class="o">/</span>Area <span class="c1"># from l/s to mm/day</span>
</pre></div>

<p>Merge P, E and Q in 1 time series object</p>

<div class="highlight highlight-R"><pre>DATA <span class="o">&lt;-</span> <span class="kp">merge</span><span class="p">(</span>P<span class="p">,</span>E<span class="p">,</span>Q<span class="p">)</span>
</pre></div>

<h3>
<a name="rainfall-runoff-modelling-using-fuse" class="anchor" href="#rainfall-runoff-modelling-using-fuse"><span class="octicon octicon-link"></span></a>Rainfall-Runoff modelling using FUSE</h3>

<p>As an example, we could combine 50 parameter sets and 4 model structures to generate 200 model simulations.</p>

<p>Sample 50 parameter sets for FUSE, using LHS method</p>

<div class="highlight highlight-R"><pre><span class="kn">library</span><span class="p">(</span>fuse<span class="p">)</span>
data<span class="p">(</span>DATA<span class="p">)</span>

<span class="kp">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
NumberOfRuns <span class="o">&lt;-</span> <span class="m">10</span>    
parameters <span class="o">&lt;-</span> GeneratePsetsFUSE<span class="p">(</span>NumberOfRuns<span class="p">)</span>
</pre></div>

<p>Choose a list of models to take into account</p>

<div class="highlight highlight-R"><pre>data<span class="p">(</span>modlist<span class="p">)</span>
parentModels <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">60</span><span class="p">,</span><span class="m">230</span><span class="p">,</span><span class="m">342</span><span class="p">,</span><span class="m">426</span><span class="p">)</span> <span class="c1"># those are the parent models </span>
ModelList <span class="o">&lt;-</span> modlist<span class="p">[</span><span class="kp">which</span><span class="p">(</span>modlist<span class="o">$</span>mid <span class="o">%in%</span> parentModels<span class="p">),]</span>
<span class="kp">row.names</span><span class="p">(</span>ModelList<span class="p">)</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>
</pre></div>

<p>Define the list of Model Performance Indices (MPIs)</p>

<div class="highlight highlight-R"><pre><span class="kn">library</span><span class="p">(</span>tiger<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>qualV<span class="p">)</span>

LAGTIME <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> lagtime<span class="p">(</span>x<span class="o">$</span>Qo<span class="p">,</span>x<span class="o">$</span>Qs<span class="p">)</span>    
MAE     <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">mean</span><span class="p">(</span>x<span class="o">$</span>Qs <span class="o">-</span> x<span class="o">$</span>Qo<span class="p">,</span> na.rm <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>            
NSHF    <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="m">1</span> <span class="o">-</span> EF<span class="p">(</span>x<span class="o">$</span>Qo<span class="p">,</span>x<span class="o">$</span>Qs<span class="p">)</span>           
NSLF    <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="m">1</span> <span class="o">-</span> EF<span class="p">(</span> <span class="kp">log</span><span class="p">(</span>x<span class="o">$</span>Qo<span class="p">)</span> <span class="p">,</span> <span class="kp">log</span><span class="p">(</span>x<span class="o">$</span>Qs<span class="p">)</span> <span class="p">)</span>           
RR      <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">sum</span><span class="p">(</span>x<span class="o">$</span>Qs<span class="p">)</span> <span class="o">/</span><span class="kp">sum</span><span class="p">(</span>x<span class="o">$</span>Po<span class="p">)</span>

MPIs <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span><span class="s">"LAGTIME"</span><span class="o">=</span>LAGTIME<span class="p">,</span><span class="s">"MAE"</span><span class="o">=</span>MAE<span class="p">,</span><span class="s">"NSHF"</span><span class="o">=</span>NSHF<span class="p">,</span><span class="s">"NSLF"</span><span class="o">=</span>NSLF<span class="p">,</span><span class="s">"RR"</span><span class="o">=</span>RR<span class="p">)</span>
</pre></div>

<p>Run simulations</p>

<div class="highlight highlight-R"><pre>outputFolder <span class="o">&lt;-</span> <span class="s">"~"</span>
deltim <span class="o">&lt;-</span> <span class="m">1</span><span class="o">/</span><span class="m">24</span> <span class="c1"># or dt/60/60/24</span>
warmup <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">dim</span><span class="p">(</span>DATA<span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">/</span><span class="m">10</span><span class="p">,</span><span class="m">0</span><span class="p">)</span>

<span class="c1"># It is recommended to run simulations on HPC facilities. </span>
<span class="c1"># However small batches can be run locally using the function MCsimulations()</span>
MCsimulations<span class="p">(</span>DATA<span class="p">,</span>deltim<span class="p">,</span>warmup<span class="p">,</span>parameters<span class="p">,</span>ModelList<span class="p">,</span>outputFolder<span class="p">,</span>MPIs<span class="p">)</span>
</pre></div>

<h3>
<a name="find-the-best-configurations-amongst-those-simulated" class="anchor" href="#find-the-best-configurations-amongst-those-simulated"><span class="octicon octicon-link"></span></a>Find the best configuration(s) amongst those simulated</h3>

<p>For this task it is necessary to install another experimental package called AMCA:</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install pure package</span>
install_github<span class="p">(</span><span class="s">"r_amca"</span><span class="p">,</span> username <span class="o">=</span> <span class="s">"cvitolo"</span><span class="p">,</span> subdir <span class="o">=</span> <span class="s">"amca"</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>amca<span class="p">)</span>
</pre></div>

<p>Run the algorithm:</p>

<div class="highlight highlight-R"><pre>results <span class="o">&lt;-</span> amca<span class="p">(</span>DATA<span class="p">,</span>ModelList<span class="p">,</span>warmup<span class="p">,</span>parameters<span class="p">,</span>outputFolder<span class="p">)</span>
</pre></div>

<p>The best configuration is stored in</p>

<div class="highlight highlight-R"><pre>results<span class="o">$</span>RETable
</pre></div>

<h3>
<a name="frequency-analysis" class="anchor" href="#frequency-analysis"><span class="octicon octicon-link"></span></a>Frequency Analysis</h3>

<p>For this task it is necessary to install another packages:</p>

<div class="highlight highlight-R"><pre><span class="c1"># Install and load packages </span>
install.packages<span class="p">(</span><span class="s">"hydromad"</span><span class="p">,</span> repos<span class="o">=</span><span class="s">"http://hydromad.catchment.org"</span><span class="p">)</span>
install.packages<span class="p">(</span><span class="s">"EcoHydRology"</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>EcoHydRology<span class="p">)</span>
</pre></div>

<p>Identify events Precipitation-discharge events:</p>

<div class="highlight highlight-R"><pre>df <span class="o">&lt;-</span> EventIdentification<span class="p">(</span>DATA<span class="p">)</span>
</pre></div>

<h3>
<a name="curve-number" class="anchor" href="#curve-number"><span class="octicon octicon-link"></span></a>Curve Number</h3>

<h1>
<a name="determine-the-cn-for-each-event" class="anchor" href="#determine-the-cn-for-each-event"><span class="octicon octicon-link"></span></a>Determine the CN for each event</h1>

<h1>
<a name="where-p--q-are-in-inches-and-area-is-in-acre" class="anchor" href="#where-p--q-are-in-inches-and-area-is-in-acre"><span class="octicon octicon-link"></span></a>where P &amp; Q are in inches and area is in acre</h1>

<div class="highlight highlight-R"><pre>Q <span class="o">&lt;-</span> df<span class="o">$</span>Q<span class="o">/</span><span class="m">25.4</span>       <span class="c1"># in inches</span>
P <span class="o">&lt;-</span> df<span class="o">$</span>P<span class="o">/</span><span class="m">25.5</span>       <span class="c1"># in inches</span>
area <span class="o">&lt;-</span> Area<span class="o">*</span><span class="m">247.105</span> <span class="c1"># in acre</span>

CN <span class="o">&lt;-</span> calculateCN<span class="p">(</span>P<span class="p">,</span>Q<span class="p">);</span> df<span class="o">$</span>CN <span class="o">&lt;-</span> CN
myCN <span class="o">&lt;-</span> median<span class="p">(</span> <span class="kp">sort</span><span class="p">(</span>CN<span class="p">,</span> decreasing <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">]</span> <span class="p">)</span>

</pre></div>

<h1>
<a name="leave-your-feedback" class="anchor" href="#leave-your-feedback"><span class="octicon octicon-link"></span></a>Leave your feedback</h1>

<p>I would greatly appreciate if you could leave your feedbacks via email (<a href="mailto:cvitolodev@gmail.com">cvitolodev@gmail.com</a>).</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">R pure maintained by <a href="https://github.com/cvitolo">cvitolo</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-44379190-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
